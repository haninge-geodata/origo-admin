{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://origo-admin.haninge.se/schemas/geojson-layer",
  "title": "Skapa GeoJSON-lager",
  "description": "Configuration schema for GeoJSON layers in Origo mapping applications",
  "type": "object",
  "required": ["name", "title", "type", "source", "abstract"],
  "properties": {
    "name": {
      "type": "string",
      "title": "Name",
      "description": "Unique internal identifier for the layer. Avoid spaces and special characters. Use double underscore plus suffix for reusable layers (e.g., 'layer__variant1')",
      "pattern": "^[a-zA-Z0-9_-]+(__[a-zA-Z0-9_-]+)?$",
      "minLength": 1,
      "maxLength": 100,
      "x-ui": {
        "component": "text",
        "section": "main",
        "placeholder": "my_layer_name",
        "help": "Example: buildings__residential or parcels__2024",
        "layout": {
          "priority": 1,
          "group": "basic-info"
        }
      },
      "x-table": {
        "headerName": "Namn",
        "visible": true
      }
    },
    "title": {
      "type": "string",
      "title": "Title",
      "description": "User-visible title for the layer",
      "minLength": 1,
      "maxLength": 200,
      "x-ui": {
        "component": "text",
        "section": "main",
        "placeholder": "Buildings Layer",
        "layout": {
          "priority": 2,
          "group": "basic-info"
        }
      },
      "x-table": {
        "headerName": "Titel",
        "visible": true
      }
    },
    "abstract": {
      "type": "string",
      "title": "Abstract",
      "description": "Short description shown in layer info (optional)",
      "minLength": 1,
      "maxLength": 1000,
      "x-ui": {
        "component": "textarea",
        "section": "main",
        "rows": 3,
        "placeholder": "Brief description of the layer's content and purpose"
      }
    },
    "type": {
      "type": "string",
      "title": "Type",
      "description": "Layer source type",
      "enum": ["GEOJSON"],
      "default": "GEOJSON",
      "x-ui": {
        "component": "select",
        "section": "main",
        "readOnly": true
      },
      "x-table": {
        "headerName": "Typ",
        "visible": true
      }
    },
    "source": {
      "type": "string",
      "title": "Source",
      "description": "URL to the GeoJSON data source",
      "format": "uri",
      "pattern": "^https?://.*",
      "x-ui": {
        "component": "text",
        "section": "main",
        "placeholder": "https://example.com/data.geojson"
      },
      "x-table": {
        "headerName": "Källa",
        "visible": true
      }
    },
    "projection": {
      "type": "string",
      "title": "Projection",
      "description": "Coordinate reference system (e.g., 'EPSG:4326'). Must be configured in proj4Defs unless EPSG:4326 or 3857",
      "pattern": "^EPSG:[0-9]+$",
      "default": "EPSG:4326",
      "x-ui": {
        "component": "text",
        "section": "advanced"
      }
    },
    "style": {
      "type": "string",
      "title": "Style",
      "description": "Name of the referenced style for the layer",
      "minLength": 1,
      "x-ui": {
        "component": "api-select",
        "section": "main"
      },
      "x-datasource": {
        "type": "api",
        "endpoint": "styles",
        "valueField": "id",
        "labelField": "name",
        "cache": true,
        "manageUrl": "/styles"
      }
    },
    "styleByAttribute": {
      "type": "boolean",
      "title": "Style by Attribute",
      "description": "Style features based on their style attribute",
      "default": false,
      "x-ui": {
        "component": "checkbox",
        "section": "main"
      }
    },
    "group": {
      "type": "string",
      "title": "Group",
      "description": "Group the layer belongs to. Required for legend inclusion",
      "x-ui": {
        "component": "text",
        "section": "main"
      }
    },
    "queryable": {
      "type": "boolean",
      "title": "Queryable",
      "description": "Enable feature info queries for this layer",
      "default": true,
      "x-ui": {
        "component": "checkbox",
        "section": "main",
        "layout": {
          "priority": 10,
          "group": "layer-options"
        }
      },
      "x-table": {
        "headerName": "Frågbar"
      }
    },
    "opacity": {
      "type": "number",
      "title": "Opacity",
      "description": "Layer opacity (0 = transparent, 1 = opaque)",
      "minimum": 0,
      "maximum": 1,
      "default": 1,
      "x-ui": {
        "component": "slider",
        "section": "main",
        "step": 0.1,
        "marks": [{
            "value": 0,
            "label": "0%"
          },
          {
            "value": 0.5,
            "label": "50%"
          },
          {
            "value": 1,
            "label": "100%"
          }
        ]
      }
    },
    "legend": {
      "type": "boolean",
      "title": "Show in Legend",
      "description": "Include layer in map legend",
      "default": false,
      "x-ui": {
        "component": "checkbox",
        "section": "main",
        "layout": {
          "priority": 11,
          "group": "layer-options"
        }
      }
    },
    "attribution": {
      "type": "string",
      "title": "Attribution",
      "description": "Copyright or source attribution text shown in footer",
      "maxLength": 500,
      "x-ui": {
        "component": "textarea",
        "section": "main",
        "rows": 2,
        "placeholder": "© Data Provider 2024"
      }
    },
    "visible": {
      "type": "boolean",
      "title": "Visible",
      "description": "Layer visibility on map load",
      "default": false,
      "x-ui": {
        "component": "checkbox",
        "section": "main",
        "layout": {
          "priority": 12,
          "group": "layer-options"
        }
      },
      "x-table": {
        "headerName": "Synlig"
      }
    },
    "extent": {
      "type": "array",
      "title": "Layer Extent",
      "description": "Bounding box extent [minX, minY, maxX, maxY]. Uses map extent if not specified",
      "items": {
        "type": "number"
      },
      "minItems": 4,
      "maxItems": 4,
      "default": [0, 0, 0, 0],
      "x-ui": {
        "section": "advanced",
        "placeholder": "Enter 4 coordinates: minX, minY, maxX, maxY"
      }
    },
    "minScale": {
      "type": "number",
      "title": "Minimum Scale",
      "description": "Minimum scale denominator for layer visibility",
      "default": 10,
      "minimum": 1,
      "x-ui": {
        "component": "number",
        "section": "advanced",
        "placeholder": "1000"
      }
    },
    "maxScale": {
      "type": "number",
      "title": "Maximum Scale",
      "description": "Maximum scale denominator for layer visibility",
      "minimum": 1,
      "x-ui": {
        "component": "number",
        "section": "advanced",
        "placeholder": "100000"
      }
    },
    "attributes": {
      "type": "object",
      "title": "Attribute Configuration",
      "description": "Definition of how attributes are presented in feature info",
      "patternProperties": {
        "^[a-zA-Z0-9_]+$": {
          "type": "object",
          "properties": {
            "title": {
              "type": "string",
              "minLength": 1,
              "maxLength": 100
            },
            "type": {
              "type": "string",
              "enum": ["string", "number", "date", "url", "image"]
            },
            "visible": {
              "type": "boolean",
              "default": true
            },
            "format": {
              "type": "string"
            }
          },
          "required": ["title", "type"],
          "additionalProperties": false
        }
      },
      "additionalProperties": false,
      "x-ui": {
        "component": "json-editor",
        "section": "advanced",
        "placeholder": "{\n  \"field1\": {\n    \"title\": \"Field Name\",\n    \"type\": \"string\"\n  }\n}"
      }
    },
    "layerType": {
      "type": "string",
      "title": "Layer Type",
      "description": "Vector layer rendering method",
      "enum": ["cluster", "image", "vector"],
      "default": "vector",
      "x-ui": {
        "component": "select",
        "section": "advanced",
        "options": [{
            "value": "vector",
            "label": "Vector"
          },
          {
            "value": "cluster",
            "label": "Cluster"
          },
          {
            "value": "image",
            "label": "Image"
          }
        ]
      }
    },
    "clusterStyle": {
      "type": "string",
      "title": "Cluster Style",
      "description": "Style for clustered features (required when layerType is 'cluster')",
      "x-ui": {
        "component": "api-select",
        "section": "main"
      },
      "x-datasource": {
        "type": "api",
        "endpoint": "styles",
        "valueField": "id",
        "labelField": "name",
        "cache": true
      }
    },
    "clusterOptions": {
      "type": "object",
      "title": "Cluster Options",
      "description": "Clustering configuration options",
      "properties": {
        "clusterDistance": {
          "type": "number",
          "title": "Cluster Distance",
          "description": "Pixel distance for clustering",
          "minimum": 1,
          "maximum": 200,
          "default": 40
        },
        "clusterMaxZoom": {
          "type": "number",
          "title": "Cluster Max Zoom",
          "description": "Maximum zoom level for clustering",
          "minimum": 0,
          "maximum": 20,
          "default": 2
        }
      },
      "additionalProperties": false,
      "x-ui": {
        "component": "json-editor",
        "section": "advanced",
        "placeholder": "{\n  \"clusterDistance\": 40,\n  \"clusterMaxZoom\": 2\n}"
      }
    },
    "searchable": {
      "title": "Searchable",
      "description": "Layer inclusion in search control",
      "type": "boolean",
      "default": false,
      "x-ui": {
        "component": "checkbox",
        "section": "main"
      }
    },
    "featureinfoTitle": {
      "type": "string",
      "title": "Feature Info Title Attribute",
      "description": "Attribute to use as popup/sidebar title instead of the title property",
      "x-ui": {
        "component": "text",
        "section": "main",
        "placeholder": "name_field"
      }
    },
    "removable": {
      "type": "boolean",
      "title": "Removable",
      "description": "Add 'Remove layer' option to layer info menu",
      "default": false,
      "x-ui": {
        "component": "checkbox",
        "section": "advanced"
      }
    },
    "zoomToExtent": {
      "type": "boolean",
      "title": "Zoom to Extent",
      "description": "Add 'Zoom To' option to layer info menu",
      "default": false,
      "x-ui": {
        "component": "checkbox",
        "section": "advanced"
      }
    },
    "exportable": {
      "type": "boolean",
      "title": "Exportable",
      "description": "Add 'Export layer' option to layer info menu",
      "default": false,
      "x-ui": {
        "component": "checkbox",
        "section": "advanced"
      }
    },
    "exportFormat": {
      "type": "array",
      "title": "Export Formats",
      "description": "Available export formats when exportable is true",
      "items": {
        "type": "string",
        "enum": ["geojson", "gpx", "kml"]
      },
      "uniqueItems": true,
      "minItems": 1,
      "default": ["geojson"],
      "x-ui": {
        "component": "multi-select",
        "section": "advanced",
        "options": [{
            "value": "geojson",
            "label": "GeoJSON"
          },
          {
            "value": "gpx",
            "label": "GPX"
          },
          {
            "value": "kml",
            "label": "KML"
          }
        ]
      }
    },
    "opacityControl": {
      "type": "boolean",
      "title": "Opacity Control",
      "description": "Show opacity slider in legend extended layer info",
      "default": true,
      "x-ui": {
        "component": "checkbox",
        "section": "main"
      }
    },
    "css": {
      "type": "object",
      "title": "CSS Properties",
      "description": "CSS properties applied to layer canvas element",
      "additionalProperties": {
        "type": "string"
      },
      "x-ui": {
        "component": "key-value",
        "section": "advanced",
        "placeholder": "{\n  \"filter\": \"blur(2px)\",\n  \"mix-blend-mode\": \"multiply\"\n}"
      }
    },
    "headers": {
      "type": "object",
      "title": "HTTP Headers",
      "description": "Headers included in GeoJSON requests (e.g., API keys, content type)",
      "additionalProperties": {
        "type": "string"
      },
      "x-ui": {
        "component": "key-value",
        "section": "advanced",
        "placeholder": "{\n  \"Authorization\": \"Bearer token\",\n  \"Accept\": \"application/geo+json\"\n}"
      }
    },
    "attachments": {
      "type": "object",
      "title": "Attachments Configuration",
      "description": "Configuration for editing and displaying attachments",
      "properties": {
        "enabled": {
          "type": "boolean",
          "title": "Enable Attachments",
          "default": false
        },
        "maxSize": {
          "type": "number",
          "title": "Maximum File Size (MB)",
          "minimum": 1,
          "default": 10
        },
        "allowedTypes": {
          "type": "array",
          "title": "Allowed File Types",
          "items": {
            "type": "string"
          },
          "default": ["image/jpeg", "image/png", "application/pdf"]
        }
      },
      "x-ui": {
        "component": "object",
        "section": "advanced"
      }
    },
    "thematicStyling": {
      "type": "boolean",
      "title": "Thematic Styling",
      "description": "Add buttons to toggle different thematic styles on/off",
      "default": false,
      "x-ui": {
        "component": "checkbox",
        "section": "main"
      }
    }
  },
  "x-ui": {
    "sections": {
      "main": {
        "title": "Layer Configuration",
        "description": "Essential settings for your GeoJSON layer",
        "order": 1,
        "collapsible": false
      },
      "advanced": {
        "title": "Advanced Settings",
        "description": "Technical configuration with pre-populated defaults",
        "order": 2,
        "collapsible": true,
        "defaultCollapsed": true
      }
    }
  }
}